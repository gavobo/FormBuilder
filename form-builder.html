<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GRID Form Builder – Prototype (Wizard)</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Dancing+Script:wght@600&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Vendor libs for client-side PDF + QR -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <!-- Form-Builder config (flip useBackend to true after proxy is deployed) -->
  <script>
    window.FB_CONFIG = {
      useBackend: false,                 // set to true after /api/parse is live
      vs: { endpoint: '/api/parse' }     // same-origin Vercel proxy
    };
  </script>

  <!-- Hidden schema that drives LLM output -->
  <script id="vs-schema" type="application/json">
  {
    "version": 1,
    "instructions": "Return ONLY JSON (no prose). Produce a top-level object with keys { template_id, fields, missing_required, confidence }. For fields, use EXACT keys from the template’s 'fields' section. Dates use YYYY-MM-DD. Peso values: prefix '₱' and thousand-separate.",
    "templates": {
      "listing": {
        "required": ["ownerName","brokerName","propertyAddress","listingType","listingTerm","listPrice","date"],
        "optional": ["commissionPercent","coBrokerSplit","terminationDays"],
        "fields": {
          "ownerName":         {"type":"string"},
          "brokerName":        {"type":"string"},
          "propertyAddress":   {"type":"string"},
          "listingType":       {"type":"enum","values":["Exclusive","Open"]},
          "listingTerm":       {"type":"string"},
          "listPrice":         {"type":"currency","format":"PHP"},
          "commissionPercent": {"type":"string"},
          "coBrokerSplit":     {"type":"string"},
          "terminationDays":   {"type":"string"},
          "date":              {"type":"date","format":"YYYY-MM-DD"}
        }
      },
      "lease": {
        "required": ["lessorName","lesseeName","propertyAddress","permittedUse","leaseStart","leaseEnd","monthlyRent","date"],
        "optional": ["securityDeposit"],
        "fields": {
          "lessorName":      {"type":"string"},
          "lesseeName":      {"type":"string"},
          "propertyAddress": {"type":"string"},
          "permittedUse":    {"type":"string"},
          "leaseStart":      {"type":"date","format":"YYYY-MM-DD"},
          "leaseEnd":        {"type":"date","format":"YYYY-MM-DD"},
          "monthlyRent":     {"type":"currency","format":"PHP"},
          "securityDeposit": {"type":"string"},
          "date":            {"type":"date","format":"YYYY-MM-DD"}
        }
      },
      "loi": {
        "required": ["loiBuyerTenantName","sellerLandlordName","propertyAddress","offerType","date"],
        "optional": ["offerPrice","monthlyRent","earnestMoney","dueDiligenceDays","closingDate","validThrough"],
        "fields": {
          "loiBuyerTenantName":{"type":"string"},
          "sellerLandlordName":{"type":"string"},
          "propertyAddress":  {"type":"string"},
          "offerType":        {"type":"enum","values":["Purchase","Lease"]},
          "offerPrice":       {"type":"currency","format":"PHP"},
          "monthlyRent":      {"type":"currency","format":"PHP"},
          "earnestMoney":     {"type":"currency","format":"PHP"},
          "dueDiligenceDays": {"type":"string"},
          "closingDate":      {"type":"date","format":"YYYY-MM-DD"},
          "validThrough":     {"type":"date","format":"YYYY-MM-DD"},
          "date":             {"type":"date","format":"YYYY-MM-DD"}
        }
      }
    }
  }
  </script>
</head>
<body>
  <header class="site-header">
    <div class="wrap">
      <div class="brand">
        <div class="logo"></div>
        <span>GRID Form Builder – Prototype</span>
      </div>
      <div class="status">Status: <span id="statusBadge" class="badge">Draft</span></div>
    </div>
  </header>

  <main class="layout">
    <!-- LEFT COLUMN: Steps + Templates + Branding -->
    <aside class="left">
      <section class="card">
        <h2>Quick Start (3 Steps)</h2>
        <ol class="steps">
          <li><b>Pick a Form</b> below.</li>
          <li><b>Describe</b> what you want (or click <i>Smart Fill</i>).</li>
          <li><b>Preview → Export PDF</b> (or Publish & Verify).</li>
        </ol>
      </section>

      <section id="panelForms" class="card">
        <h2>Forms</h2>
        <div id="templates" class="templates"></div>
      </section>

      <section class="card">
        <h2>Branding</h2>
        <label>Organization Name</label>
        <input id="orgName" type="text" placeholder="GRID Property Ventures" />
        <div class="row">
          <div>
            <label>Gradient Top</label>
            <input id="brandTop" type="color" value="#d8ab76" />
          </div>
          <div>
            <label>Gradient Bottom</label>
            <input id="brandBot" type="color" value="#b87857" />
          </div>
        </div>
        <label>Logo (URL)</label>
        <input id="logoUrl" type="text" placeholder="https://.../grid-logo.png" />
        <p class="muted">The header uses your org name, colors, and optional logo.</p>
      </section>

      <section class="card">
        <h2>Helpful Shortcuts</h2>
        <div class="actions">
          <button id="btnSample" class="ghost" data-tooltip="Fill the editor with example values.">Use Sample Data</button>
          <button id="btnSmart" class="ghost" data-tooltip="Analyze your sentence and auto-fill fields.">Smart Fill (Mock AI)</button>
        </div>
      </section>
    </aside>

    <!-- RIGHT COLUMN: Wizard + Editor + Preview -->
    <section class="right card">
      <!-- Wizard progress -->
      <nav class="wizard" aria-label="Steps">
        <ol class="wizard-steps">
          <li id="wStep1" class="current"><span>1</span> Pick Form</li>
          <li id="wStep2"><span>2</span> Describe</li>
          <li id="wStep3"><span>3</span> Preview & Sign</li>
          <li id="wStep4"><span>4</span> Export/Publish</li>
        </ol>
      </nav>

      <h2>Describe your form</h2>
      <textarea id="instructions" class="editor" placeholder="Describe what you need, e.g.:
Adjust for a warehouse leasing proposal in Cabuyao, Laguna.
Budget 350k monthly, 3 months deposit, 3-year term,
move-in on 2026-03-01, 30-day due diligence."></textarea>

      <div class="actions">
        <button id="btnPreview" class="primary" data-tooltip="Render the template using your inputs.">Generate Preview</button>
        <button id="btnReset" class="ghost" data-tooltip="Clear the editor and preview.">Reset</button>
      </div>

      <!-- Zoom controls -->
      <div class="actions" id="zoomBar" style="margin:6px 0 12px;">
        <button id="zoomOut">Zoom −</button>
        <button id="zoomReset">100%</button>
        <button id="zoomIn">Zoom +</button>
      </div>

      <h2>Live Preview</h2>
      <div id="preview" class="preview">
        <p class="muted">Step 1: pick a form on the left. Step 2: describe it above. Then click <b>Generate Preview</b>.</p>
      </div>

      <!-- Field Inspector -->
      <div id="fieldInspector">
        <h3>Field Inspector</h3>
        <div class="kv" id="fieldInspectorGrid">
          <div class="small">No fields yet. Paste instructions or click “Use Sample Data”.</div>
        </div>
      </div>

      <div id="exportActions" class="actions tail">
        <button id="btnDownload" class="accent" data-tooltip="Export preview as a PDF." disabled>Download PDF</button>
        <button id="btnPublish" class="ok" data-tooltip="Create a mock share page stored in your browser." disabled>Publish Page (Mock)</button>
        <button id="btnVerify" class="ghost" data-tooltip="Open a verify view using the document code." disabled>Open Verify</button>
      </div>

      <!-- Wizard controls -->
      <div class="wizard-controls">
        <button id="btnBack" class="ghost" data-tooltip="Go to the previous step." disabled>← Back</button>
        <button id="btnNext" class="primary" data-tooltip="Continue to the next step.">Next →</button>
        <button id="btnStartOver" class="ghost" data-tooltip="Start the wizard from Step 1.">Start Over</button>
      </div>

      <!-- Screen reader updates -->
      <div id="stepAnnouncer" class="sr-only" aria-live="polite"></div>
    </section>
  </main>

  <footer class="site-footer">Prototype only. Everything runs in your browser (localStorage).</footer>

  <!-- Toast host -->
  <div id="toastHost" class="toast-host"></div>

  <!-- App -->
  <script src="templates.js"></script>
  <script src="app.js"></script>
</body>
</html>
